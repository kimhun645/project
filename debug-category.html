<!DOCTYPE html>
<html>
<head>
    <title>Debug Category Creation</title>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyCsXLEXI4e_3hoK_Aef6EIOwygxTJGtLek",
            authDomain: "stock-6e930.firebaseapp.com",
            projectId: "stock-6e930",
            storageBucket: "stock-6e930.firebasestorage.app",
            messagingSenderId: "1067364434675",
            appId: "1:1067364434675:web:453eed567f011715586d86"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        console.log('Firebase app:', app);
        console.log('Firestore db:', db);
        
        // Test category creation
        async function createTestCategory() {
            try {
                console.log('Creating test category...');
                
                const categoryData = {
                    name: 'Test Category ' + Date.now(),
                    description: 'Test Description',
                    is_medicine: false,
                    created_at: serverTimestamp(),
                    updated_at: serverTimestamp()
                };
                
                console.log('Category data:', categoryData);
                
                const docRef = await addDoc(collection(db, 'categories'), categoryData);
                console.log('Category created with ID:', docRef.id);
                
                // Get all categories
                const categoriesSnapshot = await getDocs(collection(db, 'categories'));
                const categories = [];
                categoriesSnapshot.forEach(doc => {
                    categories.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                console.log('All categories:', categories);
                
                document.body.innerHTML = `
                    <h1>Category Creation Test</h1>
                    <div style="background: #d4edda; padding: 15px; border-radius: 5px; margin: 10px 0;">
                        <h3>✅ Success!</h3>
                        <p>Category created with ID: <strong>${docRef.id}</strong></p>
                        <p>Total categories: <strong>${categories.length}</strong></p>
                    </div>
                    <h3>All Categories:</h3>
                    <pre style="background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto;">${JSON.stringify(categories, null, 2)}</pre>
                `;
                
            } catch (error) {
                console.error('Error creating category:', error);
                document.body.innerHTML = `
                    <h1>Category Creation Test</h1>
                    <div style="background: #f8d7da; padding: 15px; border-radius: 5px; margin: 10px 0;">
                        <h3>❌ Error!</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p><strong>Code:</strong> ${error.code}</p>
                    </div>
                    <h3>Error Details:</h3>
                    <pre style="background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto;">${error.stack}</pre>
                `;
            }
        }
        
        // Run the test
        createTestCategory();
    </script>
</head>
<body>
    <h1>Testing Category Creation...</h1>
    <p>Please wait...</p>
</body>
</html>
